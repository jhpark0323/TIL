{% extends 'base.html' %}

{% block content %}
<style>
  .custom-button {
    font-size: 5px;
    margin-top: -1rem;
  }
</style>

<div>
  <div class="d-flex justify-content-between">
    <h1 class="mb-4">ìƒì„¸ í˜ì´ì§€</h1>
  </div>
  <p>ê¸€ë²ˆí˜¸ : {{ board.id }}</p>  
  <p>ì‘ì„±ì : {{ board.author }}</p>
  <p>ê¸€ì œëª© : {{ board.title }}</p>
  <p>ê¸€ë‚´ìš© : {{ board.content }}</p>
  <p>ì‘ì„±ë‚ ì§œ : {{ board.created_at }}</p>
  <p>ìˆ˜ì •ë‚ ì§œ : {{ board.updated_at }}</p>
  <hr>
  <div style='text-align:right;'><p>ì¢‹ì•„ìš” ìˆ˜ : {{board.likes.all|length}}</p></div>
  <div class="mb-5 d-flex justify-content-between">
    <a href="{% url 'boards:index' %}"><button class="btn btn-light">ë©”ì¸ í˜ì´ì§€ë¡œ</button></a>
    {% if board.author == request.user %}
    <div class="d-flex">
      <a href="{% url 'boards:update' board.id %}"><button class="me-3 btn btn-success">ìˆ˜ì •í•˜ê¸°</button></a>
      <form action="{% url 'boards:detail' board.id%}" method='POST'>
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">ì‚­ì œí•˜ê¸°</button>
      </form>
    </div>
    {% else %}
    <div>
      <form action="{% url "boards:likes" board.pk %}" method='POST'>
        {% csrf_token %}
        {% if request.user in board.likes.all %}
        <input type="submit" value='â¤'>
        {% else %}
        <input type="submit" value='ğŸ¤'>
        {% endif %}
      </form>
    </div>
    {% endif %}
  </div>
  {% if request.user.is_authenticated %}
  <form action="{% url 'boards:comment' board.id %}" method='POST'>
    {% csrf_token %}
    <button class="btn btn-secondary" style="float: right;" type="submit">ì‘ì„±í•˜ê¸°</button>
    {{ comment_form.as_p }}
  </form>
  {% else %}
  <p>ëŒ“ê¸€ì„ ì‘ì„±í•˜ì‹œë ¤ë©´ ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”.</p>
  {% endif %}

  <div class="mt-5">
    {% if comments|length == 0 %} ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
    {% else %}
      {% for comment in comments %}
      <div class="my-3 d-flex justify-content-between">
        <div>
          <span>{{ comment.author }} : {{ comment.content }}</span>
          <span class="mx-5">({{ comment.created_at }})</span>
        </div>
          <div>
            {% if comment.author == request.user %}
            <form action="{% url 'boards:comment_detail' board.id comment.id %}" method='POST'>
              {% csrf_token %}
              <button class="btn btn-light">ì‚­ì œí•˜ê¸°</button>
            </form>
            {% endif %}
          </div>
        </div>
        {% for reply_comment in comment.replies.all %}
          <div class="d-flex">
            <p class="ms-3" style="font-size: 5px;">{{ forloop.counter }}ë²ˆì§¸ ë‹µê¸€ - {{ reply_comment.author }} : {{ reply_comment.content }}</p>
            {% if reply_comment.author == request.user %}
              <form class="ms-5" action="{% url 'boards:comment_detail' board.id reply_comment.id %}" method='POST'>
                {% csrf_token %}
                <button class="btn btn-light custom-button">ë‹µê¸€ ì‚­ì œí•˜ê¸°</button>
              </form>
            {% endif %}
          </div>
        {% endfor %}
        <form class="ms-3" style="font-size: 8px;" action="{% url 'boards:create_reply' comment.id %}" method='POST'>
          {% csrf_token %}
          <button class="btn btn-secondary" style="float: right; font-size: 8px;" type="submit">ë‹µê¸€ ì‘ì„±í•˜ê¸°</button>
          {{ comment_form.as_p }}
        </form>
        <hr/>
      {% endfor %}
    {% endif %}
  </div>
</div>
{% endblock content %}